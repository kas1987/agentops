version: 2
mission: "Make every coding agent session smarter than the last"
vision: "You define what good looks like. Your agent handles the rest — and gets better at it every time."
tagline: "Your coding agent gets smarter every time you use it."
pillars:
  - knowledge-compounding
  - validated-acceleration
  - goal-driven-automation
  - zero-friction-workflow

goals:
  # === Pillar: Knowledge Compounding (weight 4-5) ===

  - id: readme-compounding-hero
    description: "README hero tagline is 'Your coding agent gets smarter every time you use it'"
    check: "head -10 README.md | grep -qi 'gets smarter every time you use it'"
    weight: 5
    pillar: knowledge-compounding

  - id: readme-compounding-story
    description: "README leads with the compounding story (session 1 vs session N improvement narrative)"
    check: "head -50 README.md | grep -qi 'session.*smarter\\|session.*better\\|session.*learns\\|session.*compounds'"
    weight: 4
    pillar: knowledge-compounding

  - id: no-sigma-rho-user-facing
    description: "No sigma/rho/delta Greek notation in README or user-facing skill SKILL.md descriptions"
    check: "grep -rl 'σ\\|ρ\\|δ' README.md skills/*/SKILL.md 2>/dev/null | grep -v references/ | grep -v shared/ | wc -l | tr -d ' ' | xargs test 0 -eq"
    weight: 3
    pillar: knowledge-compounding

  - id: positioning-no-vibe-coding-primary
    description: "Positioning doc does not use 'DevOps for Vibe-Coding' as primary tagline"
    check: "head -15 docs/positioning/devops-for-vibe-coding.md | grep -c 'Primary.*DevOps for Vibe-Coding' | xargs test 0 -eq"
    weight: 3
    pillar: knowledge-compounding

  - id: mission-in-goals-yaml
    description: "GOALS.yaml mission matches deliberation consensus"
    check: "grep -q 'Make every coding agent session smarter than the last' GOALS.yaml"
    weight: 5
    pillar: knowledge-compounding

  # === Pillar: Validated Acceleration (weight 3-4) ===

  - id: status-skill-shows-health
    description: "/status skill references knowledge health or flywheel metrics"
    check: "grep -qi 'flywheel\\|knowledge.*health\\|compounding\\|retrieval.*rate' skills/status/SKILL.md"
    weight: 3
    pillar: validated-acceleration

  - id: council-structured-verdicts
    description: "/council outputs structured PASS/WARN/FAIL verdicts"
    check: "grep -q 'PASS.*WARN.*FAIL\\|verdict.*PASS\\|PASS | WARN | FAIL' skills/council/SKILL.md"
    weight: 4
    pillar: validated-acceleration

  - id: vibe-runs-complexity
    description: "/vibe skill runs complexity analysis before council"
    check: "grep -qi 'complexity' skills/vibe/SKILL.md"
    weight: 3
    pillar: validated-acceleration

  - id: crank-wave-vibe-gate
    description: "/crank enforces wave vibe gates between waves"
    check: "grep -qi 'wave.*vibe\\|vibe.*gate' skills/crank/SKILL.md"
    weight: 3
    pillar: validated-acceleration

  # === Pillar: Goal-Driven Automation (weight 3-4) ===

  - id: evolve-dormancy-messaging
    description: "/evolve skill documents dormancy as a valid success state"
    check: "grep -qi 'dormancy\\|dormant\\|nothing to do.*valid\\|all goals met.*stop' skills/evolve/SKILL.md"
    weight: 3
    pillar: goal-driven-automation

  - id: no-autonomous-user-facing
    description: "README does not use the word 'autonomous' (use 'hands-free' or 'goal-driven' instead)"
    check: "grep -ci 'autonomous' README.md | xargs test 0 -eq"
    weight: 3
    pillar: goal-driven-automation

  - id: evolve-kill-switch
    description: "/evolve has documented kill switch (KILL and STOP files)"
    check: "grep -q 'KILL' skills/evolve/SKILL.md && grep -q 'STOP' skills/evolve/SKILL.md"
    weight: 4
    pillar: goal-driven-automation

  - id: rpi-gate-retry-logic
    description: "/rpi has retry gates for pre-mortem FAIL and vibe FAIL"
    check: "grep -qi 'retry.*loop\\|max.*attempts\\|FAIL.*retry\\|retry.*FAIL' skills/rpi/SKILL.md"
    weight: 3
    pillar: goal-driven-automation

  - id: goals-yaml-pillar-coverage
    description: "GOALS.yaml has goals for all 4 pillars"
    check: "grep -c 'pillar: knowledge-compounding' GOALS.yaml | xargs test 0 -lt && grep -c 'pillar: validated-acceleration' GOALS.yaml | xargs test 0 -lt && grep -c 'pillar: goal-driven-automation' GOALS.yaml | xargs test 0 -lt && grep -c 'pillar: zero-friction-workflow' GOALS.yaml | xargs test 0 -lt"
    weight: 4
    pillar: goal-driven-automation

  # === Pillar: Zero-Friction Workflow (weight 3) ===

  - id: quickstart-under-5min
    description: "/quickstart skill promises value in under 5 minutes"
    check: "grep -qi '5 min\\|five min\\|under.*minutes\\|minutes.*or less' skills/quickstart/SKILL.md"
    weight: 3
    pillar: zero-friction-workflow

  - id: session-start-injects-knowledge
    description: "Session start hook injects prior knowledge automatically"
    check: "grep -qi 'inject\\|ao inject\\|knowledge' hooks/session-start.sh"
    weight: 4
    pillar: zero-friction-workflow

  - id: handoff-skill-exists
    description: "/handoff skill exists for seamless session continuity"
    check: "test -f skills/handoff/SKILL.md && grep -q '^name:' skills/handoff/SKILL.md"
    weight: 3
    pillar: zero-friction-workflow

  - id: implement-single-issue
    description: "/implement skill exists for single-issue execution"
    check: "test -f skills/implement/SKILL.md && grep -q '^name:' skills/implement/SKILL.md"
    weight: 3
    pillar: zero-friction-workflow

  # === Critical (weight 5) — Build & test integrity (infrastructure — no pillar tag by design) ===

  - id: go-cli-builds
    description: "Go CLI compiles without errors"
    check: "cd cli && go build -o /tmp/test-ao ./cmd/ao >/dev/null 2>&1"
    weight: 5

  - id: go-cli-tests
    description: "Go CLI unit tests pass"
    check: "cd cli && go test ./... >/dev/null 2>&1"
    weight: 5

  # === Important (weight 3-4) — Suite & safety (infrastructure — no pillar tag by design) ===

  - id: full-test-suite
    description: "Full test suite passes (all tiers)"
    check: "./tests/run-all.sh"
    weight: 4

  - id: hook-preflight
    description: "All hooks pass safety checks (kill switches, paths)"
    check: "./scripts/validate-hook-preflight.sh >/dev/null 2>&1"
    weight: 4

  - id: smoke-tests
    description: "Smoke tests pass (toolchain, skills, manifests)"
    check: "./tests/smoke-test.sh"
    weight: 3

  - id: go-vet-clean
    description: "Go CLI passes vet checks (no common bugs)"
    check: "cd cli && go vet ./... 2>&1"
    weight: 3

  - id: manifest-versions-match
    description: "Plugin and marketplace versions are in sync"
    check: "test \"$(jq -r '.metadata.version' .claude-plugin/marketplace.json)\" = \"$(jq -r '.version' .claude-plugin/plugin.json)\""
    weight: 3

  - id: go-race-clean
    description: "Go CLI passes race detector (no data races)"
    check: "cd cli && go test -race ./... >/dev/null 2>&1"
    weight: 3

  # === Mission fitness (weight 2-3) — AO ownership areas (infrastructure — no pillar tag by design) ===

  - id: knowledge-flywheel-health
    description: "Knowledge flywheel has ≥5 learnings and newest is <30 days old"
    check: "test $(ls .agents/learnings/*.md 2>/dev/null | wc -l | tr -d ' ') -ge 5 && test $(find .agents/learnings/ -name '*.md' -mtime -30 2>/dev/null | wc -l | tr -d ' ') -ge 1"
    weight: 3

  - id: skill-semantic-stability
    description: "Core skills have name, tier, and description in YAML frontmatter"
    check: "for s in council crank swarm rpi vibe pre-mortem post-mortem plan research implement evolve; do grep -q '^name:' skills/$s/SKILL.md && grep -q 'tier:' skills/$s/SKILL.md && grep -q '^description:' skills/$s/SKILL.md || exit 1; done"
    weight: 3

  - id: bridge-contract-schemas
    description: "Bridge contracts doc defines all 3 canonical surfaces (INVOCATION_ENVELOPE, STATE_CHECKPOINT_HANDOFF, OBSERVABILITY_EVENTS)"
    check: "grep -q 'INVOCATION_ENVELOPE' docs/ol-bridge-contracts.md && grep -q 'STATE_CHECKPOINT_HANDOFF' docs/ol-bridge-contracts.md && grep -q 'OBSERVABILITY_EVENTS' docs/ol-bridge-contracts.md"
    weight: 2

  - id: learning-format-compliance
    description: "All learnings conform to interchange spec (YAML frontmatter with id, type, created_at)"
    check: "bash -c 'for f in $(ls .agents/learnings/*.md 2>/dev/null); do head -10 \"$f\" | grep -q \"^---\" && head -10 \"$f\" | grep -q \"^id:\" && head -10 \"$f\" | grep -q \"^type:\" && head -10 \"$f\" | grep -q \"^created_at:\" || { echo FAIL:$f; exit 1; }; done'"
    weight: 2

  - id: council-schema-valid
    description: "Council verdict schema has additionalProperties:false at all levels and required covers core properties (v2 optional fields: fix, why, ref)"
    check: "jq -e '. as $s | ($s.additionalProperties == false) and (($s.required | length) == ($s.properties | keys | length)) and ($s.properties.findings.items.additionalProperties == false) and (($s.properties.findings.items.required | length) >= 5) and (($s.properties.findings.items.properties | keys | length) <= ($s.properties.findings.items.required | length) + 3)' skills/council/schemas/verdict.json >/dev/null 2>&1"
    weight: 2

  # === Hygiene (weight 1-2) — Docs & consistency (infrastructure — no pillar tag by design) ===

  - id: shellcheck-clean
    description: "Hook scripts pass shellcheck with no warnings"
    check: "shellcheck -x -P SCRIPTDIR hooks/*.sh 2>&1 | grep -c '^In ' | xargs test 0 -eq"
    weight: 2

  - id: go-coverage-floor
    description: "Go CLI average test coverage stays above 80%"
    check: "cd cli && go test -cover ./... 2>&1 | grep '^ok' | sed -n 's/.*coverage: \\([0-9.]*\\)%.*/\\1/p' | awk '{s+=$1;n++} END{if(n>0 && s/n>=80) exit 0; else exit 1}'"
    weight: 2

  - id: rpi-phased-context-discipline
    description: "ao rpi phased includes context discipline and handoff instructions in every phase prompt"
    check: "grep -q 'CONTEXT DISCIPLINE' cli/cmd/ao/rpi_phased.go && grep -q 'handoff' cli/cmd/ao/rpi_phased.go && grep -q 'phaseContextBudgets' cli/cmd/ao/rpi_phased.go"
    weight: 3
    pillar: zero-friction-workflow

  - id: rpi-context-window-contract
    description: "RPI large-repo context sharding contract is healthy and runnable."
    check: "./scripts/rpi/context-window-contract.sh"
    weight: 2

  - id: doc-coverage
    description: "All public skills have references/ documentation"
    check: "test $(ls -d skills/*/references/ 2>/dev/null | wc -l | tr -d ' ') -ge 16"
    weight: 2

  - id: skill-tier-coverage
    description: "All skills have tier: defined in YAML frontmatter"
    check: "test $(grep -rl 'tier:' skills/*/SKILL.md 2>/dev/null | wc -l | tr -d ' ') -eq $(ls -d skills/*/ 2>/dev/null | wc -l | tr -d ' ')"
    weight: 2

  - id: skill-validation
    description: "All skills have valid SKILL.md with frontmatter"
    check: "./tests/skills/run-all.sh"
    weight: 2

  - id: orchestration-skills-validated
    description: "All orchestration-tier skills have validate.sh scripts"
    check: "for d in council crank swarm codex-team rpi evolve; do test -x skills/$d/scripts/validate.sh || exit 1; done"
    weight: 2

  - id: behavioral-skill-contracts
    description: "All 34 skills have behavioral validate.sh checks that pass"
    check: "for d in skills/*/scripts/validate.sh; do \"$d\" >/dev/null 2>&1 || exit 1; done"
    weight: 2

  - id: hook-tests-pass
    description: "All 100 hook integration tests pass"
    check: "bash tests/hooks/test-hooks.sh 2>&1 | tail -1 | grep -q 'ALL PASSED'"
    weight: 2

  - id: export-constraints-readiness
    description: "ao export-constraints subcommand is stubbed in CLI"
    check: "grep -rq 'export.constraints\\|export-constraints\\|exportConstraints' cli/cmd/ao/ 2>/dev/null"
    weight: 1

  - id: incident-runbook-exists
    description: "Consumer incident runbook exists with recovery procedures"
    check: "test -f docs/INCIDENT-RUNBOOK.md && grep -q 'AGENTOPS_HOOKS_DISABLED' docs/INCIDENT-RUNBOOK.md"
    weight: 1
